<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>ALTTP Graphics</title>
	<link href="https://fonts.googleapis.com/css?family=Teko:600&amp;subset=latin-ext" rel="stylesheet">
	<link rel="stylesheet" href="style/layout.css">

	<link rel="import" href="elements/molecules/alttp-runner/alttp-runner.html">
</head>

<body>
	<div id="container">
		<img id="background" src="assets/backgrounds/bg2-blank.png">
		<layout-commentary></layout-commentary>
	</div>

	<dom-module id="layout-commentary">
		<template>
			<style>
				*{
					box-sizing: border-box;
					font-family: Teko;
					color: #fff;
				}

				#commentators {
					position: absolute;
					left: 0;
					top: 669px;
					font-size: 24px;
					height: 54px;
					line-height: 54px;
					width: 1280px;
					text-align: center;
					vertical-align: middle;

				}

				#commentators img {
					max-height: 24px;
					vertical-align: middle;
				}

				#matchInfo {
					position: absolute;
					top: 23px;
					width: 1280px;
					text-align: center;
					font-size: 24px;
					line-height: 1em;
				}

				.textShadow {

					text-shadow: 4px 0px 0 rgba(0, 0, 0, 0.4),
					4px 1px 0 rgba(0, 0, 0, 0.4),
					3px 2px 0 rgba(0, 0, 0, 0.4),
					3px 3px 0 rgba(0, 0, 0, 0.4),
					2px 3px 0 rgba(0, 0, 0, 0.4),
					1px 4px 0 rgba(0, 0, 0, 0.4),

					0px 4px 0 rgba(0, 0, 0, 0.4),
					-1px 4px 0 rgba(0, 0, 0, 0.4),
					-2px 3px 0 rgba(0, 0, 0, 0.4),
					-3px 3px 0 rgba(0, 0, 0, 0.4),
					-3px 2px 0 rgba(0, 0, 0, 0.4),
					-4px 1px 0 rgba(0, 0, 0, 0.4),

					-4px 0px 0 rgba(0, 0, 0, 0.4),
					-4px -1px 0 rgba(0, 0, 0, 0.4),
					-3px -2px 0 rgba(0, 0, 0, 0.4),
					-3px -3px 0 rgba(0, 0, 0, 0.4),
					-2px -3px 0 rgba(0, 0, 0, 0.4),
					-1px -4px 0 rgba(0, 0, 0, 0.4),

					0px -4px 0 rgba(0, 0, 0, 0.4),
					1px -4px 0 rgba(0, 0, 0, 0.4),
					2px -3px 0 rgba(0, 0, 0, 0.4),
					3px -3px 0 rgba(0, 0, 0, 0.4),
					3px -2px 0 rgba(0, 0, 0, 0.4),
					4px -1px 0 rgba(0, 0, 0, 0.4);

					letter-spacing: 1px;
				}
				#countdown{
					position: absolute;
					left: 388px;
					top: 564px;
					font-size:24px;
				}
			</style>

			<template is="dom-repeat" items="[[runners]]" as="runner">
				<alttp-runner index="[[index]]" runner="[[runner]]"></alttp-runner>
			</template>

			<div id="countdown" class="textShadow"><template is="dom-if" if="[[countdownVisible]]">
					<span style="font-family: monospace">[[countdown]]</span>
				</template>
			</div>
			<div id="commentators" class="textShadow">
				<img src="assets/images/commentator.png" /> [[commentators]]
			</div>
			<div id="matchInfo" class="textShadow">
				[[round]]
				<br /> [[standings]]
			</div>
		</template>



		<script>
			const currentRun = nodecg.Replicant('currentRun');
			const currentRunExtra = nodecg.Replicant('currentRunExtra');
			const time = nodecg.Replicant('countdown');
			const running = nodecg.Replicant('countdownRunning');

			Polymer({
				is: 'layout-commentary',

				properties: {
					numRunners: {
						type: Number,
						reflectToAttribute: true,
						value: 1
					},
					runners: Array,
					commentators: String,
					round: String,
					standings: String,
					countdown: String,
					countdownVisible: {
						type: Boolean,
						value: false
					}
				},

				ready() {
					time.on('change', newVal => {
						if(!newVal)
							return;
						this.countdown = `${newVal.minutes}:${newVal.seconds.toString().padStart(2, '0')}`;
					});
					running.on('change', newVal => {
						if(!newVal){
							this.countdownVisible = false;
							return;
						}
						this.countdownVisible = newVal;
						console.log(this.countdownVisible);
					});

					currentRun.on('change', newVal => {
						if (!newVal) {
							return;
						}
						this.commentators = newVal.commentators.map(comm => comm.name).join(', ');
						this.runners = newVal.runners;
						if (newVal.runners.length !== 3 && newVal.runners.length <= 4) {
							this.numRunners = newVal.runners.length;
						}
					});

					currentRunExtra.on('change', newVal => {
						if (!newVal)
							return;
						this.round = newVal.round;
						this.standings = newVal.standings;
					});

				},

			});
		</script>
	</dom-module>
</body>

</html>